# Pre-commit hooks for TTA.dev
# These run automatically before each commit to catch security issues BEFORE GitHub
#
# Install: uv run pre-commit install
# Run manually: uv run pre-commit run --all-files
# Skip (emergency): git commit --no-verify

repos:
  # Semgrep - CodeQL-equivalent security scanning (via uvx to avoid deps conflict)
  # Catches: SQL injection, XSS, command injection, secrets in code, etc.
  - repo: local
    hooks:
      - id: semgrep
        name: "ğŸ”’ Semgrep Security Scan"
        entry: uvx semgrep --config=auto --config=p/python --config=p/security-audit --config=p/secrets --error --quiet
        language: system
        types: [python]
        pass_filenames: true
        exclude: ^(.cline/|.hypertool/|_archive/|\.venv/)

  # Bandit - Python-specific security linter
  # Catches: Hardcoded passwords, SQL injection, shell injection, etc.
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        name: "ğŸ›¡ï¸ Bandit Security Scan"
        args:
          - -c
          - .bandit.yaml
          - -ll  # Medium+ severity only
          - -r
        types: [python]

  # Ruff - Fast Python linter (already in your workflow)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.0
    hooks:
      - id: ruff
        name: "âš¡ Ruff Lint"
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format
        name: "âœ¨ Ruff Format"

  # Detect secrets before they hit the repo
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: "ğŸ” Detect Secrets"
        args: ['--baseline', '.secrets.baseline']
        exclude: package-lock\.json|\.secrets\.baseline

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-yaml
        name: "ğŸ“„ Check YAML"
      - id: check-json
        name: "ğŸ“„ Check JSON"
      - id: check-toml
        name: "ğŸ“„ Check TOML"
      - id: end-of-file-fixer
        name: "ğŸ“ Fix EOF"
      - id: trailing-whitespace
        name: "ğŸ“ Trim Whitespace"
      - id: check-added-large-files
        name: "ğŸ“¦ Check Large Files"
        args: ['--maxkb=1000']
      - id: check-merge-conflict
        name: "ğŸ”€ Check Merge Conflicts"
      - id: debug-statements
        name: "ğŸ› Check Debug Statements"

# CI configuration
ci:
  autofix_commit_msg: "style: auto-fix by pre-commit hooks"
  autoupdate_commit_msg: "chore: update pre-commit hooks"
