# TTA.dev Secret Rotation Alert Configuration
# Configure notification channels for rotation failures and security events

# Environment-specific configurations
environments:
  development:
    slack_enabled: true
    pagerduty_enabled: false
    email_enabled: true
    alert_thresholds:
      critical_failures: 1  # Alert on any failed rotation in dev
      consecutive_failures: 1

  staging:
    slack_enabled: true
    pagerduty_enabled: false
    email_enabled: true
    alert_thresholds:
      critical_failures: 2
      consecutive_failures: 2

  production:
    slack_enabled: true
    pagerduty_enabled: true
    email_enabled: true
    alert_thresholds:
      critical_failures: 3  # Wait for multiple failures before alerting in prod
      consecutive_failures: 2

# Slack Configuration
slack:
  webhook_url: "${SLACK_WEBHOOK_URL}"  # Environment variable
  channel: "#security-alerts"
  username: "Secret Rotation Monitor"
  icon_emoji: ":lock:"
  notifications:
    enabled: true
    on_critical_failure: true
    on_service_down: true
    on_compliance_breach: true
    daily_summary: false
    weekly_report: true

# PagerDuty Configuration
pagerduty:
  integration_key: "${PAGERDUTY_INTEGRATION_KEY}"  # Environment variable
  service_name: "tta-secret-rotation"
  escalation_policy: "security-team-escalation"
  notifications:
    enabled: true
    on_critical_failure: true
    on_multiple_service_failures: true
    during_business_hours_only: false

# Email Configuration
email:
  enabled: true
  smtp_server: "${SMTP_SERVER}"
  smtp_port: 587
  smtp_username: "${SMTP_USERNAME}"
  smtp_password: "${SMTP_PASSWORD}"
  from_address: "secret-rotation@tta.dev"
  recipients:
    primary: ["security@tta.dev"]
    escalation: ["oncall@tta.dev"]
  notifications:
    enabled: true
    on_critical_failure: true
    on_compliance_breach: true
    weekly_summary: true

# Alert Rules
alert_rules:
  # Critical Alerts (immediate notification)
  critical_failure:
    trigger: "any_rotation_fails_more_than_3_times_in_1_hour"
    priority: "CRITICAL"
    channels: ["slack", "pagerduty", "email"]
    description: "Multiple rotation failures detected - immediate investigation required"

  service_down:
    trigger: "service_success_rate_below_50_percent_for_1_hour"
    priority: "HIGH"
    channels: ["slack", "email"]
    description: "Service experiencing repeated rotation failures"

  compliance_breach:
    trigger: "data_masking_violation_detected"
    priority: "HIGH"
    channels: ["slack", "email"]
    description: "Security compliance violation - sensitive data may be exposed"

  # Warning Alerts (delayed notification)
  rotation_delay:
    trigger: "rotation_overdue_by_24_hours"
    priority: "MEDIUM"
    channels: ["slack"]
    description: "Secret rotation schedule is behind"

  partial_failure:
    trigger: "single_rotation_failure_after_successful_run"
    priority: "LOW"
    channels: ["slack"]
    description: "Occasional rotation failure detected"

# Escalation Rules
escalation:
  initial_alert_timeout: "15_minutes"  # Time before escalating
  escalation_levels:
    level_1:           # Security Team
      timeout: "1_hour"
      notify: ["security@tta.dev"]
    level_2:           # On-call SRE
      timeout: "4_hours"
      notify: ["oncall@tta.dev", "+15551234567"]
    level_3:           # Executive Team
      timeout: "24_hours"
      notify: ["cto@tta.dev", "ceo@tta.dev"]

# Suppressed Alerts (by time window)
suppression:
  maintenance_window: "sunday_02:00-04:00_utc"  # Suppress during maintenance
  known_issues:
    - service: "gemini"
      issue: "api_rate_limit"
      suppress_until: "2025-12-01"
    - service: "github"
      issue: "api_migration"
      suppress_until: "2025-11-30"

# Notification Templates
templates:
  slack_critical: |
    üö® *CRITICAL: Secret Rotation Failure*
    Service: {service}
    Error: {error}
    Impact: Key rotation paused - security risk
    Action required immediately!

  slack_warning: |
    ‚ö†Ô∏è *WARNING: Secret Rotation Issue*
    Service: {service}
    Status: {status}
    Details: {details}

  email_subject_critical: "üö® CRITICAL: Secret Rotation Failure - {service}"
  email_subject_warning: "‚ö†Ô∏è WARNING: Secret Rotation Issue - {service}"

  email_body_critical: |
    Subject: CRITICAL: Secret Rotation Failure Detected

    Service: {service}
    Error: {error}
    Timestamp: {timestamp}
    Environment: {environment}

    IMMEDIATE ACTION REQUIRED:
    1. Investigate rotation failure
    2. Verify service accessibility
    3. Check API credentials
    4. Confirm fallback procedures

    This alert was generated by the automated secret rotation monitoring system.

  pagerduty_critical: |
    Multiple secret rotation failures detected for {service}.
    Error: {error}
    Environment: {environment}
    Requires immediate investigation by security team.
