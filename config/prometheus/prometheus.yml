# TTA.dev Professional Prometheus Configuration
# Production-grade configuration for comprehensive monitoring

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'tta-dev'
    environment: 'development'
    replica: '1'

# Rule files for recording and alerting rules
rule_files:
  - "/etc/prometheus/rules/recording_rules.yml"
  - "/etc/prometheus/rules/alerting_rules.yml"

# AlertManager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

# Scrape configurations for comprehensive monitoring
scrape_configs:
  # Self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 30s
    metrics_path: '/metrics'

  # TTA.dev Live Metrics Server (your current running server)
  - job_name: 'tta-live-metrics'
    static_configs:
      - targets: ['host.docker.internal:9464']  # Docker host (cross-platform)
    scrape_interval: 5s
    scrape_timeout: 3s
    metrics_path: '/metrics'
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: host.docker.internal:9464

  # TTA.dev Applications (dynamic discovery for multiple apps)
  - job_name: 'tta-applications'
    static_configs:
      - targets:
        - 'host.docker.internal:8000'  # Agent Activity Tracker
        - 'host.docker.internal:8001'  # Future TTA.dev app
        - 'host.docker.internal:8002'  # Future TTA.dev app
    scrape_interval: 10s
    scrape_timeout: 5s
    metrics_path: '/metrics'

  # OpenTelemetry Collector - Infrastructure metrics
  - job_name: 'otel-collector'
    static_configs:
      - targets:
        - 'otel-collector:8888'  # Collector own metrics
        - 'otel-collector:8889'  # Prometheus exporter metrics
    scrape_interval: 10s
    metrics_path: '/metrics'

  # Pushgateway - Short-lived job metrics (git hooks, CI/CD)
  - job_name: 'pushgateway'
    honor_labels: true
    static_configs:
      - targets: ['pushgateway:9091']
    scrape_interval: 5s
    metrics_path: '/metrics'

  # Infrastructure Monitoring
  - job_name: 'jaeger'
    static_configs:
      - targets: ['jaeger:14269']  # Jaeger metrics endpoint
    scrape_interval: 30s
    metrics_path: '/metrics'

  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    scrape_interval: 30s
    metrics_path: '/metrics'

  # Node/System Metrics (if node_exporter is added)
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 10s
    # This will be used when we add node_exporter for system metrics

  # TTA.dev Package-specific metrics
  - job_name: 'tta-primitives'
    static_configs:
      - targets: ['host.docker.internal:9464']
    scrape_interval: 5s
    metrics_path: '/metrics'
    metric_relabel_configs:
      # Add package labels for better organization
      - source_labels: [__name__]
        regex: 'tta_(.*)'
        target_label: 'tta_package'
        replacement: 'tta-dev-primitives'

  - job_name: 'tta-observability'
    static_configs:
      - targets: ['host.docker.internal:9465']  # Future observability package metrics
    scrape_interval: 10s
    metrics_path: '/metrics'
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'tta_obs_(.*)'
        target_label: 'tta_package'
        replacement: 'tta-observability-integration'

# Remote write for long-term storage (future enhancement)
# remote_write:
#   - url: "http://thanos-receive:19291/api/v1/receive"

# Note: Storage retention settings are configured via command-line flags in docker-compose.yml
# --storage.tsdb.retention.time=30d
# --storage.tsdb.retention.size=10GB
