# TTA.dev Zsh Environment Setup Guide

**Agent-Centric Shell Configuration for AI-Powered Workflows**

## üéØ Overview

This Zsh configuration is designed for developers working with AI agents. It provides a standardized, high-performance shell environment with clear boundaries between agent-managed and user-controlled settings.

### Key Principles

1. **Standardization** - Predictable structure for automation reliability
2. **Security** - Clear separation between agent-accessible and private settings
3. **Performance** - Optimized startup time (<200ms target)
4. **Composability** - Easy for both humans and agents to extend

## üì¶ What's Included

### Foundation

- **Oh My Zsh** - The standard framework for Zsh configuration
- **Powerlevel10k** - Rich, informative prompt with instant context
- **Separation of Concerns** - Agent-managed `.zshrc` + user-only `.zsh_local`

### Essential Plugins

| Plugin | Purpose | Agent Value |
|--------|---------|-------------|
| **zsh-autosuggestions** | Command suggestions from history | Reduces typos, shows patterns |
| **zsh-syntax-highlighting** | Real-time command validation | Prevents malformed commands |
| **fzf** | Fuzzy finder for history/files | Scriptable search interface |
| **zoxide** | Smart directory jumping | Simple navigation vs complex paths |
| **gh** | GitHub CLI | Stable API for Git automation |

### Performance Features

- **Lazy Loading** - Version managers (nvm, pyenv) load only when used
- **Optimized History** - 50,000 lines with deduplication
- **Fast Startup** - Target <200ms with profiling tools

## üöÄ Quick Start

### 1. Run Setup Script

```bash
cd /home/thein/repos/TTA.dev
./scripts/setup_zsh_environment.sh
```

This installs all required plugins and backs up your existing `.zshrc`.

### 2. Apply Configuration

```bash
# Copy the agent-managed configuration
cp scripts/zshrc.template ~/.zshrc

# Create your personal settings file
cp scripts/zsh_local.template ~/.zsh_local

# IMPORTANT: Add .zsh_local to .gitignore!
echo ".zsh_local" >> ~/.gitignore
```

### 3. Configure Powerlevel10k

```bash
# Run the interactive configuration wizard
p10k configure
```

Choose your preferred prompt style. Recommended: Rainbow, Unicode, 24-hour time, Show context.

### 4. Activate

```bash
# Reload your shell
source ~/.zshrc

# Or restart your terminal
```

## üìÅ File Structure

### Agent-Managed: `~/.zshrc`

**Purpose:** Core shell configuration managed by AI agents

**Contains:**
- Oh My Zsh setup and plugin loading
- Essential tool integrations (fzf, zoxide, gh)
- Standard aliases and functions
- Performance optimizations

**Agent Permissions:** ‚úÖ Read/Write

**When to modify:**
- Adding new plugins
- Updating aliases
- Configuring tools
- Performance tuning

### User-Managed: `~/.zsh_local`

**Purpose:** Personal settings NEVER touched by agents

**Contains:**
- API keys and tokens (OPENAI_API_KEY, GITHUB_TOKEN, etc.)
- Personal aliases and functions
- Machine-specific settings
- Private configurations

**Agent Permissions:** ‚ùå No Access

**CRITICAL:** This file MUST be in `.gitignore`!

**When to modify:**
- Adding secrets/API keys
- Personal shortcuts
- Machine-specific paths
- Anything private

### Powerlevel10k: `~/.p10k.zsh`

**Purpose:** Prompt appearance configuration

**Generated by:** `p10k configure` wizard

**Agent Permissions:** ‚úÖ Read-only (informational)

## üîë Essential Aliases

### Navigation

```bash
..      # cd ..
...     # cd ../..
....    # cd ../../..
```

### Listing

```bash
l       # ls -lFh (long format, human-readable)
la      # ls -lAFh (include hidden)
ll      # ls -alFh (all, long format)
```

### Git & GitHub

```bash
g       # git
gs      # git status
ga      # git add
gc      # git commit -m
gp      # git push
gl      # git pull
gd      # git diff
gco     # git checkout
gb      # git branch
gpr     # gh pr (Pull Requests)
gi      # gh issue (Issues)
gr      # gh repo (Repositories)
```

### TTA.dev Project

```bash
ur      # uv run
ua      # uv add
us      # uv sync --all-extras
ut      # uv run pytest -v
uf      # uv run ruff format .
ul      # uv run ruff check . --fix
uq      # Full quality check (format + lint + type check + test)
```

## üõ†Ô∏è Essential Functions

### AI-Powered Helpers

```bash
# Ask AI to explain the last command
explain

# Ask AI to suggest a command
suggest "search for large files"
```

**Note:** Requires GitHub Copilot CLI extension:
```bash
gh extension install github/gh-copilot
```

### File Operations

```bash
# Create directory and cd into it
mkcd new-project

# Quick backup with timestamp
backup important-file.txt
# Creates: important-file.txt.backup.20251110_141523

# Extract any archive
extract archive.tar.gz
```

### Search & Navigation

```bash
# Search history
hs "pytest"

# Find file by name
ff "*.py"

# Find directory by name
fd "tests"

# Smart cd (after using zoxide)
z TTA.dev      # Jump to ~/repos/TTA.dev
z prim         # Jump to primitives directory
```

### Development Tools

```bash
# Profile Zsh startup time
profile-zsh

# Reload configuration
reload

# Show active plugins
show-plugins
```

## üé® Powerlevel10k Features

Your prompt provides instant context:

- **Git Status** - Branch name, dirty/clean state, ahead/behind
- **Command Status** - Green (success) or red (failure)
- **Execution Time** - Shows time for long-running commands
- **Python/Node Version** - Active environment displayed
- **Directory Info** - Current path with smart truncation

**Customize:** Run `p10k configure` anytime to change appearance.

## ‚ö° Performance Tips

### Profile Startup Time

```bash
profile-zsh
```

Target: <200ms. If slower, investigate with:

```bash
time zsh -i -c exit
```

### Common Bottlenecks

1. **Version Managers** - Already lazy-loaded in this config
2. **Too Many Plugins** - Review with `show-plugins`
3. **Complex Functions** - Move rarely-used functions to `.zsh_local`

### Optimization Checklist

- ‚úÖ Version managers lazy-loaded (nvm, pyenv)
- ‚úÖ Minimal plugin set (only essentials)
- ‚úÖ Efficient history settings
- ‚úÖ Powerlevel10k instant prompt

## üîí Security Model

### Agent Boundaries

| File | Agent Access | Contains | Git Tracked |
|------|-------------|----------|-------------|
| `~/.zshrc` | ‚úÖ Read/Write | Configuration, aliases | Yes (template) |
| `~/.zsh_local` | ‚ùå No Access | Secrets, personal settings | **NO** |
| `~/.p10k.zsh` | ‚úÖ Read-only | Prompt configuration | Optional |

### Best Practices

1. **Never commit secrets** - Always use `.zsh_local`
2. **Review agent changes** - Check git diffs for `~/.zshrc` modifications
3. **Backup regularly** - Setup script creates timestamped backups
4. **Audit plugins** - Periodically review installed plugins

### Example .gitignore

```bash
# User-specific Zsh configuration (contains secrets!)
.zsh_local
.zsh_local.backup.*

# Optional: Powerlevel10k customization
.p10k.zsh
```

## üìö Tool Documentation

### fzf (Fuzzy Finder)

**Key Bindings:**
- `Ctrl+R` - Search command history
- `Ctrl+T` - Search files in current directory
- `Alt+C` - Search directories and cd

**Customization:**
Edit `FZF_DEFAULT_OPTS` in `~/.zshrc` or override in `~/.zsh_local`

### zoxide (Smart cd)

```bash
# After visiting directories, zoxide learns patterns
cd ~/repos/TTA.dev
cd ~/repos/TTA.dev/platform/primitives

# Later, just type:
z TTA          # Jumps to ~/repos/TTA.dev
z prim         # Jumps to primitives directory
```

**Advanced:**
```bash
zi             # Interactive selection with fzf
```

### GitHub CLI (gh)

```bash
# Pull Requests
gh pr list
gh pr view 123
gh pr create
gh pr checkout 123

# Issues
gh issue list
gh issue view 456
gh issue create

# Repositories
gh repo view
gh repo clone owner/repo
```

**AI Integration:**
```bash
# Copilot commands
gh copilot explain "git rebase -i HEAD~3"
gh copilot suggest "find large files"
```

## üß™ Testing Your Setup

### 1. Verify Plugins

```bash
show-plugins
```

Expected output:
```
Active Oh My Zsh plugins:
1  git
2  command-not-found
3  sudo
4  web-search
5  zsh-autosuggestions
6  zsh-syntax-highlighting
```

### 2. Test Tools

```bash
# Test fzf
echo "test" | fzf

# Test zoxide (after navigating around)
z --version

# Test GitHub CLI
gh --version
```

### 3. Test AI Functions

```bash
# Run a command, then explain it
ls -la
explain

# Ask for command suggestion
suggest "find files modified today"
```

### 4. Check Performance

```bash
profile-zsh
```

Should show <200ms for optimal performance.

## üîß Customization

### Adding Plugins

Edit `~/.zshrc`, find the `plugins=()` section:

```bash
plugins=(
  git
  command-not-found
  sudo
  web-search
  docker              # Add new plugins here
  kubectl
  zsh-autosuggestions
  zsh-syntax-highlighting  # Keep this last!
)
```

**Note:** `zsh-syntax-highlighting` must always be the last plugin!

### Adding Aliases

**For shared aliases** (agents can modify):
Edit `~/.zshrc` under "Agent-Friendly Aliases"

**For personal aliases** (agents never touch):
Edit `~/.zsh_local`:

```bash
# Personal shortcuts
alias proj='cd ~/projects'
alias tta='cd ~/repos/TTA.dev'
```

### Adding Functions

Same principle - shared in `~/.zshrc`, personal in `~/.zsh_local`.

## üö® Troubleshooting

### Plugin Not Working

```bash
# Reload configuration
reload

# Or restart terminal
exec zsh
```

### Slow Startup

```bash
# Profile to find bottleneck
time zsh -i -c exit

# Check for culprits
# Common: nvm, pyenv, rbenv (should be lazy-loaded)
```

### Powerlevel10k Not Showing

```bash
# Check theme is set
grep ZSH_THEME ~/.zshrc

# Should show: ZSH_THEME="powerlevel10k/powerlevel10k"

# Reconfigure
p10k configure
```

### fzf Not Working

```bash
# Check if installed
which fzf

# Check if key bindings loaded
# Try: Ctrl+R in terminal
```

### zoxide Not Jumping

```bash
# zoxide needs to learn directories first
# Visit directories normally with cd a few times
cd ~/repos/TTA.dev
cd ~/repos/TTA.dev/packages

# Then try:
z TTA
```

## üìñ Advanced Topics

### Custom Lazy Loading

Add to `~/.zshrc` or `~/.zsh_local`:

```bash
# Lazy load rbenv
if command -v rbenv &> /dev/null; then
  rbenv() {
    unset -f rbenv
    eval "$(command rbenv init -)"
    rbenv "$@"
  }
fi
```

### Environment-Specific Settings

In `~/.zsh_local`:

```bash
# Different settings per machine
if [[ $(hostname) == "work-laptop" ]]; then
  export COMPANY_VAR="value"
elif [[ $(hostname) == "home-desktop" ]]; then
  export PERSONAL_VAR="value"
fi
```

### Custom Completions

```bash
# Add to ~/.zsh_local
# Example: custom completion for a tool
compdef _git mygitwrapper=git
```

## ü§ù Agent Integration

### Safe Agent Operations

Agents should:
- ‚úÖ Modify `~/.zshrc` (configuration)
- ‚úÖ Read `~/.p10k.zsh` (informational)
- ‚ùå Never touch `~/.zsh_local` (secrets)

### Agent Script Template

```bash
#!/bin/bash
# Example: Agent adding a new plugin

# Backup current config
cp ~/.zshrc ~/.zshrc.backup.$(date +%Y%m%d_%H%M%S)

# Add plugin to list (safely)
sed -i 's/plugins=(/plugins=(\n  new-plugin/' ~/.zshrc

# Reload
zsh -c "source ~/.zshrc"
```

## üìù Maintenance

### Weekly Tasks

```bash
# Update Oh My Zsh
omz update

# Update plugins (if not auto-updated)
cd ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
git pull

# Profile performance
profile-zsh
```

### Monthly Tasks

```bash
# Review installed plugins
show-plugins

# Clean up history
# History automatically managed, but can manually clean if needed
```

## üîó Resources

### Official Documentation

- [Oh My Zsh](https://ohmyz.sh/)
- [Powerlevel10k](https://github.com/romkatv/powerlevel10k)
- [fzf](https://github.com/junegunn/fzf)
- [zoxide](https://github.com/ajeetdsouza/zoxide)
- [GitHub CLI](https://cli.github.com/)

### Plugin Documentation

- [zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions)
- [zsh-syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting)

## üìû Support

For TTA.dev-specific issues:
- GitHub Issues: https://github.com/theinterneti/TTA.dev/issues
- Documentation: `/home/thein/repos/TTA.dev/docs/`

---

**Last Updated:** November 10, 2025
**Maintained by:** TTA.dev Team
**License:** MIT
